<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>
      Monorepo | Vue3 源码解读
    </title>
    <meta name="description" content="A VitePress site">
    <link rel="stylesheet" href="/explain-vue3/assets/style.db5c977a.css">
    <link rel="modulepreload" href="/explain-vue3/assets/framework.5c8a4622.js">
    <link rel="modulepreload" href="/explain-vue3/assets/Home.791df5e7.js">
    <link rel="modulepreload" href="/explain-vue3/assets/chapter1_index.md.df1b2bf4.lean.js">
    <link rel="modulepreload" href="/explain-vue3/assets/app.d1857a09.js">
    <style>img { border-radius: 10px }h1.title { margin-left: 0.5em }</style>
    
  </head>
  <body>
    <div id="app"><!--[--><div class="theme"><header class="nav-bar" data-v-6e7c0b86><div class="sidebar-button" data-v-6e7c0b86><svg class="icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z" class></path></svg></div><a class="nav-bar-title" href="/explain-vue3/" aria-label="Vue3 源码解读, back to home" data-v-6e7c0b86 data-v-00c3af85><!----> Vue3 源码解读</a><div class="flex-grow" data-v-6e7c0b86></div><div class="nav" data-v-6e7c0b86><nav class="nav-links" data-v-6e7c0b86 data-v-f465d38e><!--[--><div class="item" data-v-f465d38e><div class="nav-link" data-v-f465d38e data-v-98431d6e><a class="item isExternal" href="https://github.com/WJCHumble/explain-vue3.0" target="_blank" rel="noopener noreferrer" data-v-98431d6e>GitHub <svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" data-v-98431d6e><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div></div><!--]--><!----><!----></nav></div><!--[--><!--]--></header><aside class="sidebar" data-v-58e261f2><nav class="nav-links nav" data-v-58e261f2 data-v-f465d38e><!--[--><div class="item" data-v-f465d38e><div class="nav-link" data-v-f465d38e data-v-98431d6e><a class="item isExternal" href="https://github.com/WJCHumble/explain-vue3.0" target="_blank" rel="noopener noreferrer" data-v-98431d6e>GitHub <svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" data-v-98431d6e><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div></div><!--]--><!----><!----></nav><!--[--><!--]--><ul class="sidebar-links" data-v-58e261f2><!--[--><li class="sidebar-link" data-v-58e261f2 data-v-58e261f2><p class="sidebar-link-item" data-v-58e261f2>准备工作</p><ul class="sidebar-links" data-v-58e261f2><li class="sidebar-link" data-v-58e261f2 data-v-58e261f2><a class="sidebar-link-item" href="/explain-vue3/chapter1/" data-v-58e261f2>Introduction</a><!----></li></ul></li><li class="sidebar-link" data-v-58e261f2 data-v-58e261f2><p class="sidebar-link-item" data-v-58e261f2>模板编译</p><ul class="sidebar-links" data-v-58e261f2><li class="sidebar-link" data-v-58e261f2 data-v-58e261f2><a class="sidebar-link-item" href="/explain-vue3/chapter2/" data-v-58e261f2>Introduction</a><!----></li><li class="sidebar-link" data-v-58e261f2 data-v-58e261f2><a class="sidebar-link-item" href="/explain-vue3/chapter2/baseParse" data-v-58e261f2>baseParse</a><!----></li><li class="sidebar-link" data-v-58e261f2 data-v-58e261f2><a class="sidebar-link-item" href="/explain-vue3/chapter2/transform" data-v-58e261f2>transform</a><!----></li><li class="sidebar-link" data-v-58e261f2 data-v-58e261f2><a class="sidebar-link-item" href="/explain-vue3/chapter2/generate" data-v-58e261f2>generate</a><!----></li></ul></li><li class="sidebar-link" data-v-58e261f2 data-v-58e261f2><p class="sidebar-link-item" data-v-58e261f2>组件创建过程</p><ul class="sidebar-links" data-v-58e261f2><li class="sidebar-link" data-v-58e261f2 data-v-58e261f2><a class="sidebar-link-item" href="/explain-vue3/chapter3/" data-v-58e261f2>Introduction</a><!----></li><li class="sidebar-link" data-v-58e261f2 data-v-58e261f2><a class="sidebar-link-item" href="/explain-vue3/chapter3/setupComponent" data-v-58e261f2>setupComponent</a><!----></li><li class="sidebar-link" data-v-58e261f2 data-v-58e261f2><a class="sidebar-link-item" href="/explain-vue3/chapter3/finishComponentSetup" data-v-58e261f2>finishComponentSetup</a><!----></li></ul></li><li class="sidebar-link" data-v-58e261f2 data-v-58e261f2><p class="sidebar-link-item" data-v-58e261f2>组件更新过程</p><ul class="sidebar-links" data-v-58e261f2><li class="sidebar-link" data-v-58e261f2 data-v-58e261f2><a class="sidebar-link-item" href="/explain-vue3/chapter4/" data-v-58e261f2>Introduction</a><!----></li></ul></li><li class="sidebar-link" data-v-58e261f2 data-v-58e261f2><p class="sidebar-link-item" data-v-58e261f2>基于 Proxy 的响应式原理</p><ul class="sidebar-links" data-v-58e261f2><li class="sidebar-link" data-v-58e261f2 data-v-58e261f2><a class="sidebar-link-item" href="/explain-vue3/chapter5/" data-v-58e261f2>Introduction</a><!----></li><li class="sidebar-link" data-v-58e261f2 data-v-58e261f2><a class="sidebar-link-item" href="/explain-vue3/chapter5/reactive" data-v-58e261f2>reactive</a><!----></li><li class="sidebar-link" data-v-58e261f2 data-v-58e261f2><a class="sidebar-link-item" href="/explain-vue3/chapter5/depCollection" data-v-58e261f2>依赖收集</a><!----></li><li class="sidebar-link" data-v-58e261f2 data-v-58e261f2><a class="sidebar-link-item" href="/explain-vue3/chapter5/notifyUpdate" data-v-58e261f2>派发更新</a><!----></li></ul></li><li class="sidebar-link" data-v-58e261f2 data-v-58e261f2><p class="sidebar-link-item" data-v-58e261f2>内置组件</p><ul class="sidebar-links" data-v-58e261f2><li class="sidebar-link" data-v-58e261f2 data-v-58e261f2><a class="sidebar-link-item" href="/explain-vue3/chapter6/" data-v-58e261f2>Introduction</a><!----></li><li class="sidebar-link" data-v-58e261f2 data-v-58e261f2><a class="sidebar-link-item" href="/explain-vue3/chapter6/teleport" data-v-58e261f2>teleport</a><!----></li></ul></li><li class="sidebar-link" data-v-58e261f2 data-v-58e261f2><p class="sidebar-link-item" data-v-58e261f2>常用指令</p><ul class="sidebar-links" data-v-58e261f2><li class="sidebar-link" data-v-58e261f2 data-v-58e261f2><a class="sidebar-link-item" href="/explain-vue3/chapter7/" data-v-58e261f2>Introduction</a><!----></li><li class="sidebar-link" data-v-58e261f2 data-v-58e261f2><a class="sidebar-link-item" href="/explain-vue3/chapter7/v-if" data-v-58e261f2>v-if</a><!----></li><li class="sidebar-link" data-v-58e261f2 data-v-58e261f2><a class="sidebar-link-item" href="/explain-vue3/chapter7/v-show" data-v-58e261f2>v-show</a><!----></li></ul></li><li class="sidebar-link" data-v-58e261f2 data-v-58e261f2><p class="sidebar-link-item" data-v-58e261f2>特性</p><ul class="sidebar-links" data-v-58e261f2><li class="sidebar-link" data-v-58e261f2 data-v-58e261f2><a class="sidebar-link-item" href="/explain-vue3/chapter8/" data-v-58e261f2>Introduction</a><!----></li><li class="sidebar-link" data-v-58e261f2 data-v-58e261f2><a class="sidebar-link-item" href="/explain-vue3/chapter8/styleCssVars" data-v-58e261f2>style css variable injection</a><!----></li></ul></li><li class="sidebar-link" data-v-58e261f2 data-v-58e261f2><p class="sidebar-link-item" data-v-58e261f2>语法糖</p><ul class="sidebar-links" data-v-58e261f2><li class="sidebar-link" data-v-58e261f2 data-v-58e261f2><a class="sidebar-link-item" href="/explain-vue3/chapter9/" data-v-58e261f2>Introduction</a><!----></li><li class="sidebar-link" data-v-58e261f2 data-v-58e261f2><a class="sidebar-link-item" href="/explain-vue3/chapter9/ref-sugar" data-v-58e261f2>ref sugar</a><!----></li></ul></li><!--]--></ul><!--[--><!--]--></aside><div class="sidebar-mask"></div><main class="page" data-v-b109f666><div class="container" data-v-b109f666><!--[--><!--]--><div class="content" data-v-b109f666><div data-v-b109f666><h2 id="monorepo"><a class="header-anchor" href="#monorepo" aria-hidden="true">#</a> Monorepo</h2><p>在「Vue3」，它采用了「Monorepo」的方式来管理项目的代码。那么，什么是「Monorepo」？我们先来看看维基百科上对「Monorepo」的介绍：</p><p><strong>———— In revision control systems, a monorepo is a software development strategy where code for many projects is stored in the same repository.</strong></p><p>简单理解，「Monorepo」<strong>指一种将多个项目放到一个仓库的一种管理项目的策略</strong>。当然，这只是概念上的理解。而对于实际开发中的场景，「Monorepo」的使用通常是通过 <code>yarn</code> 的 <code>workspaces</code> 工作空间，又或者是 <code>lerna</code> 这种高度封装的第三方工具库来实现。使用「Monorepo」的方式来管理项目会给我们带来以下这些好处：</p><ul><li>只需要一个仓库，就可以便捷地管理多个项目</li><li>可以管理不同项目中的相同第三方依赖，做到依赖的同步更新</li><li>可以使用其他项目中的代码，清晰地建立起项目间的依赖关系</li></ul><p>而「Vue3」正是采用的 <code>yarn</code> 的 <code>workspaces</code> 工作空间的方式管理整个项目，而 <code>workspaces</code> 的特点就是在 <code>package.json</code> 中会有这么两句不同于普通项目的声明：</p><div class="language-javascript"><pre><code><span class="token punctuation">{</span>
    <span class="token string">&quot;private&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token string">&quot;workspaces&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token string">&quot;packages/*&quot;</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><p>其中 <code>&quot;private&quot;: true</code> 的作用是保证了工作区的安全，避免被其他引用， <code>&quot;workspaces&quot;</code> 则是用来声明工作区所包含的项目的位置，很显然它可以声明多个，而 <code>packages/*</code> 指的是 <code>packages</code> 文件夹下的所有项目。并且，「Vue3」中对工作区的声明也是 <code>pacakges/*</code>，所以它的目录结构会是这样：</p><div class="language-javascript"><pre><code><span class="token operator">...</span>
<span class="token operator">|</span>—— packages
    <span class="token operator">|</span>———— compiler<span class="token operator">-</span>core
    <span class="token operator">|</span>———— compiler<span class="token operator">-</span>dom
    <span class="token operator">|</span>———— compiler<span class="token operator">-</span>sfc
    <span class="token operator">|</span>———— compiler<span class="token operator">-</span>ssr
    <span class="token operator">|</span>———— reactivity
    <span class="token operator">|</span>———— runime<span class="token operator">-</span>core
    <span class="token operator">|</span>———— runime<span class="token operator">-</span>dom
    <span class="token operator">|</span>———— runime<span class="token operator">-</span>test
    <span class="token operator">|</span>———— server<span class="token operator">-</span>renderer
    <span class="token operator">|</span>———— shared
    <span class="token operator">|</span>———— size<span class="token operator">-</span>check
    <span class="token operator">|</span>———— template<span class="token operator">-</span>explorer
    <span class="token operator">|</span>———— vue
    global<span class="token punctuation">.</span>dt<span class="token punctuation">.</span>s
<span class="token keyword">package</span><span class="token punctuation">.</span>json
</code></pre></div><blockquote><p>这里我只展示了 <code>packages</code> 文件目录和 <code>package.json</code>，至于其他目录有兴趣的同学可以自行了解。</p></blockquote><p>可以看到，<code>packages</code> 文件目录下根据「Vue3」实现所需要的能力划分了不同的项目，例如 <code>reactivity</code> 文件目录下就是和 <code>reactivity</code> API 相关的代码，并且它的内部的结构会是这样：</p><div class="language-javascript"><pre><code><span class="token operator">|</span>—— __tests__               ## 测试用例
<span class="token operator">|</span>—— src                     ## reactive <span class="token constant">API</span> 实现相关代码
api<span class="token punctuation">.</span>extractor<span class="token punctuation">.</span>json
index<span class="token punctuation">.</span>js
<span class="token constant">LICENSE</span>
<span class="token keyword">package</span><span class="token punctuation">.</span>json                ## reactive <span class="token constant">API</span> 实现相关代码
<span class="token constant">README</span><span class="token punctuation">.</span>md
</code></pre></div><p>在 <code>reactivity</code> 项目文件的内部也同样有 <code>package.json</code> 文件，也就是如我们上面所说的，<code>packages</code> 文件目录下的文件都各自对应着每一个单独的项目。所以，每一个项目中的 <code>package.json</code> 就对应着改项目对应的依赖、入口、打包的一些配置等等。</p><p>而「Vue3」使用「Monorepo」的方式管理项目的好处就是我们可以单独使用它的一些 API 的能力，而不是只能在「Vue」项目中使用它。很典型的例子就是，我们可以通过 <code>npm i @vue/reactivity</code> 单独安装 <code>reactivity</code> API 对应的 <code>npm</code> 包，从而在其他地方使用 <code>reactivity</code> API 来实现观察者模式。</p><blockquote><p>当然，使用「Monorepo」还需要思考诸多其他问题，例如增量编译、多任务编译等等，有兴趣同学可以自行去了解。</p></blockquote><h2 id="总结"><a class="header-anchor" href="#总结" aria-hidden="true">#</a> 总结</h2><p>那么，在简单介绍完「Vue3」是以「Monorepo」的方式管理项目后。我想，大家心中都已明了，如果我们要去了解「Vue3」怎么去实现模板编译、runtime + compiler 的巧妙结合、Virtual DOM 的实现等等原理，我们就可以从 <code>packages</code> 文件目录下的各个文件开始着手来研究它们的实现。</p></div></div><footer class="page-footer" data-v-b109f666 data-v-5a019cc9><div class="edit" data-v-5a019cc9><div class="edit-link" data-v-5a019cc9 data-v-fb0131f2><!----></div></div><div class="updated" data-v-5a019cc9><!----></div></footer><div class="next-and-prev-link" data-v-b109f666 data-v-6683615c><div class="container" data-v-6683615c><div class="prev" data-v-6683615c><!----></div><div class="next" data-v-6683615c><a class="link" href="/explain-vue3/chapter2/" data-v-6683615c><span class="text" data-v-6683615c>Introduction</span><svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="icon icon-next" data-v-6683615c><path d="M19.9,12.4c0.1-0.2,0.1-0.5,0-0.8c-0.1-0.1-0.1-0.2-0.2-0.3l-7-7c-0.4-0.4-1-0.4-1.4,0s-0.4,1,0,1.4l5.3,5.3H5c-0.6,0-1,0.4-1,1s0.4,1,1,1h11.6l-5.3,5.3c-0.4,0.4-0.4,1,0,1.4c0.2,0.2,0.5,0.3,0.7,0.3s0.5-0.1,0.7-0.3l7-7C19.8,12.6,19.9,12.5,19.9,12.4z"></path></svg></a></div></div></div><!--[--><!--]--></div></main></div><!----><!--]--></div>
    <script>__VP_HASH_MAP__ = JSON.parse("{\"index.md\":\"281a2552\",\"chapter1_index.md\":\"df1b2bf4\",\"chapter2_baseparse.md\":\"39b3f2d2\",\"chapter2_generate.md\":\"0a49c7e5\",\"chapter2_index.md\":\"db29e25f\",\"chapter2_transform.md\":\"916987ac\",\"chapter3_finishcomponentsetup.md\":\"87f32828\",\"chapter3_index.md\":\"9ea90374\",\"chapter3_setupcomponent.md\":\"cc887f1e\",\"chapter5_depcollection.md\":\"52c1bdb2\",\"chapter5_index.md\":\"9afc6eac\",\"chapter5_notifyupdate.md\":\"f82e5472\",\"chapter5_reactive.md\":\"b0b2e8c5\",\"chapter4_index.md\":\"6b664567\",\"chapter6_index.md\":\"c33f070a\",\"chapter6_teleport.md\":\"37b5fe16\",\"chapter7_index.md\":\"ef6cdd83\",\"chapter7_v-if.md\":\"b1a02c59\",\"chapter7_v-show.md\":\"fb6b149d\",\"chapter8_index.md\":\"ad7b5625\",\"chapter8_stylecssvars.md\":\"2891798e\",\"chapter9_index.md\":\"76aa5a2e\",\"chapter9_ref-sugar.md\":\"43fc6c12\"}")</script>
    <script type="module" async src="/explain-vue3/assets/app.d1857a09.js"></script>
  </body>
</html>